<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>senatorInfo</title>
    <link rel="stylesheet" href="style.css">
  </head> 
    
<body>
    
    <!--Count of each party, and list of leaders if applicable-->
    <div>
        <div>
        <h1 id="countdem"></h1>
        <ul id="demleaders"></ul>
        </div>
        <div>
        <h1 id="countrep"></h1>
        <ul id="repleaders"></ul>
        </div>
        <div>
            <h1 id="countind"></h1>
            <ul id="indleaders"></ul>
        </div>
    </div>

    <!--Buttons for filtering-->
    <div>
        <input type='checkbox' id="checkdem" onclick="filter_party_dem()"> Filter by Democrats</input>
        <input type='checkbox' id="checkrep" onclick="filter_party_rep()"> Filter by Republicans</input>
        <input type='checkbox' id="checkind" onclick="filter_party_ind()"> Filter by Independents</input>
    </div>

    <div>
        <input type='checkbox' id="checksenior" onclick="filter_rank_senior()"> Filter by Senior rank</input>
        <input type='checkbox' id="checkjunior" onclick="filter_rank_junior()"> Filter by Junior rank</input>
    </div>

    <!--A potential space for more info on each senator-->
    <div class="moreinfo">
        <p id="demo"></p>
    </div>

    <!--Main table with senator information-->
    <div id="id01"></div>   
    
<script>


//This variables is used to store the data parsed from the json file.       

var senatorArray;
    

// This XMLHttpRequest is used to parse info from the first json file. 
var xmlhttp = new XMLHttpRequest();
var url = "senators.json";   


xmlhttp.onreadystatechange = function() {
    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
        
        //Parse the JSON data to a JavaScript variable. 
        var parsedData = JSON.parse(xmlhttp.responseText);    
        // These functions are defined below and deal with the JSON data read from the file. 
        DemRepCount(parsedData);
        senatorInfo(parsedData); 
    }
};

xmlhttp.open("GET", url, true);
xmlhttp.send();

//onclick function for buttons in senator table
function ClickFunction(id) {
    document.getElementById("demo").innerHTML = id;
}


//function to count the total amount of democrats and republicans and check for leadership roles
function DemRepCount(obj) {
    let demcount, repcount, indcount, demli, repli, indli;

    senatorArray  = obj.objects;
    demcount = 0;
    repcount = 0;
    indcount = 0;
    demli = "";
    repli = "";
    indli = "";

    //iterates through data and counts number of senators in each party
    for (var i=0; i<senatorArray.length; i++) {
        var party = senatorArray[i].party;
        if (party == "Democrat") {
            demcount ++;
        }
        else if (party == "Republican") {
            repcount ++;
        }
        else if (party == "Independent") {
            indcount ++;
        }

        //checks for party leaders and formats name/role for list
        var leadership_title = senatorArray[i].leadership_title;
        var firstName = senatorArray[i].person.firstname;
        var lastName = senatorArray[i].person.lastname;

        if (leadership_title != null){
            if (party == "Democrat") {
                demli +=
                `<li>${leadership_title}: ${firstName} ${lastName} (${party})</li>`;
            }
            if (party == "Republican") {
                repli += 
                `<li>${leadership_title}: ${firstName} ${lastName} (${party})</li>`;
            }
            if (party == "Independent") {
                indli += 
                `<li>${leadership_title}: ${firstName} ${lastName} (${party})</li>`;
            }
        }

    }

    //adds count of senators to heading, and role/name to lists
    document.getElementById("demleaders").innerHTML = demli;
    document.getElementById("repleaders").innerHTML = repli;
    document.getElementById("indleaders").innerHTML = indli;
    document.getElementById("countdem").innerHTML = `Count of Democrat Senators: ${demcount}`;
    document.getElementById("countrep").innerHTML = `Count of Republican Senators: ${repcount}`;
    document.getElementById("countind").innerHTML = `Count of Independent Senators: ${indcount}`;
}


// This function is used to read the data stored from the daily json file and display it in a table. 
function senatorInfo(obj) {
       
    senatorArray = obj.objects;
    
    var contact_out = "<table id='maintable'>";
    contact_out += "<caption>List of Senators</caption><tr><th>First Name</th><th>Last Name</th><th>Party</th><th>State</th><th>Gender</th><th>Rank</th><th>More</th></tr>";    
    // Then iterate through the array and populate table rows and columns .
    for (var i=0; i <senatorArray.length; i++) 
    {    
        var pvsidnum = senatorArray[i].person.pvsid;
        
        var firstName = senatorArray[i].person.firstname;
        var lastName = senatorArray[i].person.lastname;
        var party = senatorArray[i].party;
        var state = senatorArray[i].state;
        var gender = senatorArray[i].person.gender_label;
        var rank = senatorArray[i].senator_rank_label;
        
        contact_out += "<tr><td>" +
        firstName +
        "</td><td>" +
        lastName +
        "</td><td>" +
        party +
        "</td><td>" +
        state +
        "</td><td>" +
        gender +
        "</td><td>" +
        rank +
        "</td><td>" +
        "<button type='button' class='moreinfo' onclick='ClickFunction(" +
        pvsidnum +
        ")'>Click for more information</button></tr>";
        
    }
    
    // Close the table element.
    contact_out += "</table>";    
    document.getElementById("id01").innerHTML = contact_out;
}     

//Filters by democrat party
function filter_party_dem() {
    var filter = "Democrat";
    var table = document.getElementById('maintable');
    var tr = table.getElementsByTagName("tr");
    var checkBox = document.getElementById("checkdem");

    if (checkBox.checked == true){
        for (i = 0; i < tr.length; i++){
            td = tr[i].getElementsByTagName("td")[2];
            if (td) {
                text = td.TextContent || td.innerText;
                if (text == filter) {
                    tr[i].style.display = "";
                }
                else {
                    tr[i].style.display = "none";
                }
            }
        }
    }
    else {
        for (i = 0; i < tr.length; i++){
            td = tr[i].getElementsByTagName("td")[2];
            tr[i].style.display = "";
        }
    }
}


//Filters by ind party
function filter_party_ind() {
    var filter = "Independent";
    var table = document.getElementById('maintable');
    var tr = table.getElementsByTagName("tr");
    var checkBox = document.getElementById("checkind");

    if (checkBox.checked == true){
        for (i = 0; i < tr.length; i++){
            td = tr[i].getElementsByTagName("td")[2];
            if (td) {
                text = td.TextContent || td.innerText;
                if (text == filter) {
                    tr[i].style.display = "";
                }
                else {
                    tr[i].style.display = "none";
                }
            }
        }
    }
    else {
        for (i = 0; i < tr.length; i++){
            td = tr[i].getElementsByTagName("td")[2];
            tr[i].style.display = "";
        }
    }
}

//Filters by republican party
function filter_party_rep() {
    var filter = "Republican";
    var table = document.getElementById('maintable');
    var tr = table.getElementsByTagName("tr");
    var checkBox = document.getElementById("checkrep");

    if (checkBox.checked == true){
        for (i = 0; i < tr.length; i++){
            td = tr[i].getElementsByTagName("td")[2];
            if (td) {
                text = td.TextContent || td.innerText;
                if (text == filter) {
                    tr[i].style.display = "";
                }
                else {
                    tr[i].style.display = "none";
                }
            }
        }
    }
    else {
        for (i = 0; i < tr.length; i++){
            td = tr[i].getElementsByTagName("td")[2];
            tr[i].style.display = "";
        }
    }
}

//Filters by senior rank
function filter_rank_senior() {
    var filter = "Senior";
    var table = document.getElementById('maintable');
    var tr = table.getElementsByTagName("tr");
    var checkBox = document.getElementById("checksenior");

    if (checkBox.checked == true){
        for (i = 0; i < tr.length; i++){
            td = tr[i].getElementsByTagName("td")[5];
            if (td) {
                text = td.TextContent || td.innerText;
                if (text == filter) {
                    tr[i].style.display = "";
                }
                else {
                    tr[i].style.display = "none";
                }
            }
        }
    }
    else {
        for (i = 0; i < tr.length; i++){
            td = tr[i].getElementsByTagName("td")[5];
            tr[i].style.display = "";
        }
    }
}

//Filters by junior rank
function filter_rank_junior() {
    var filter = "Junior";
    var table = document.getElementById('maintable');
    var tr = table.getElementsByTagName("tr");
    var checkBox = document.getElementById("checkjunior");

    if (checkBox.checked == true){
        for (i = 0; i < tr.length; i++){
            td = tr[i].getElementsByTagName("td")[5];
            if (td) {
                text = td.TextContent || td.innerText;
                if (text == filter) {
                    tr[i].style.display = "";
                }
                else {
                    tr[i].style.display = "none";
                }
            }
        }
    }
    else {
        for (i = 0; i < tr.length; i++){
            td = tr[i].getElementsByTagName("td")[5];
            tr[i].style.display = "";
        }
    }
}
    


    
    
</script>
    
    
    

    
    
</body>
</html> 
